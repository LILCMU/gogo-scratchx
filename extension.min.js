new function(){function resetData(){input=new Uint8Array(CONST.o)}function sendToBoard(o){device.write(o)}function stopPolling(){poller&&clearInterval(poller),poller=null}function convertByteStr(o){return(parseInt(o,16)-128)/128}function bytesToInt(o,n){return(o<<8)+n}function bitSet(o,n){return o|1<<n}function bitTest(o,n){return(o>>n)%2!=0}function validateInt(o,n,t){return o=parseInt(o)||0,n=n||0,o=o<0?0:o,t&&(o=o>t?t:o),o}function getMotorID(o){return(o=o||"").toLowerCase()in MOTOR_DICT?MOTOR_DICT[o.toLowerCase()]:0}function convertMotorToBits(o,n,t,e){for(var r=0,s=[o,n,t,e],C=0;C<s.length;C++)getMotorID(s[C])==C+1&&(r=bitSet(r,C));return r}function getSensorValue(o){var n=0;return!(o=parseInt(o))||o<1||o>8?n:((n=bytesToInt(input[2*o-1],input[2*o-1+1]))>=1020&&(n=1024),n)}function shouldHandle(o){var n=void 0==handledCmds[o];return n&&(handledCmds[o]=!0),n}var CONST={t:0,s:1,C:2,_:3,T:0,i:1,O:2,u:1,S:2,R:3,N:4,I:6,m:7,P:8,A:9,v:10,M:11,D:12,g:13,p:50,h:51,L:60,G:61,B:62,F:70,H:71,U:72,V:73,W:74,k:100,Y:1,X:2,K:3,Z:4,j:1,J:2,$:10,oo:11,no:12,to:15,eo:16,ro:17,so:18,Co:19,_o:20,To:25,ao:26,io:0,Oo:1,lo:2,PARAMETER1:3,PARAMETER2:4,PARAMETER3:5,PARAMETER4:6,PARAMETER5:7,PARAMETER6:8,PARAMETER7:9,uo:64,o:64,do:5,countNoData:0,So:17,co:18,Ro:20,No:25,Eo:33,Io:0,mo:1,Po:2,Ao:3,vo:4,RPI_REG_IP_1:10,RPI_REG_IP_2:11,RPI_REG_IP_3:12,RPI_REG_IP_4:13,RPI_REG_WLAN_IP_1:14,RPI_REG_WLAN_IP_2:15,RPI_REG_WLAN_IP_3:16,RPI_REG_WLAN_IP_4:17,fo:18,Mo:19,Do:20,po:21,ho:22,Lo:23,wo:24,Go:25,Bo:26,xo:27,Fo:28,Ho:29,bo:0,Uo:1,Vo:2},MOTOR_DICT={a:1,b:2,c:3,d:4},device=null,input=new Uint8Array(CONST.o),poller=null,ext=this,handledCmds={};!function(o,n,t,e,r,s,C){o.GoogleAnalyticsObject=r,o[r]=o[r]||function(){(o[r].q=o[r].q||[]).push(arguments)},o[r].l=1*new Date,s=n.createElement(t),C=n.getElementsByTagName(t)[0],s.async=1,s.src="https://www.google-analytics.com/analytics.js",C.parentNode.insertBefore(s,C)}(window,document,"script",0,"gga"),gga("create","UA-83816046-7","auto"),gga("send","pageview");var sendCommand=function(o){if(device){var n=new ArrayBuffer(CONST.uo),t=new Uint8Array(n);for(var e in o)t[parseInt(e)-0]=o[e];device.write(n)}},sendControlCommand=function(o){o[CONST.Oo]=CONST.T,sendCommand(o)},stringToByes=function(o,n,t){o=o.toString(),t=t||CONST.PARAMETER1,o.length>60&&(o=o.substring(0,60));var e=0;if(!n)return e;for(var r in o)n[t+e]=o.charCodeAt(e),e+=1;return n[t+e]=0,n},controls={ping:function(){var o={};o[CONST.lo]=CONST.u,o[CONST.PARAMETER1]=0,sendControlCommand(o)},pingNode:function(o){var n={};n[CONST.lo]=CONST.u,n[CONST.PARAMETER1]=1,n[CONST.PARAMETER2]=o,sendControlCommand(n)},beep:function(){var o=[];o[CONST.lo]=CONST.M,sendControlCommand(o)},setAutorun:function(o){var n={};n[CONST.lo]=CONST.D,n[CONST.PARAMETER1]=o,sendControlCommand(n)},LogoControl:function(o){o=parseInt(o);var n={};n[CONST.lo]=CONST.g,n[CONST.PARAMETER1]=o,sendControlCommand(n)},mOn:function(){var o={};o[CONST.lo]=CONST.S,o[CONST.PARAMETER1]=0,o[CONST.PARAMETER2]=1,sendControlCommand(o)},mOff:function(){var o={};o[CONST.lo]=CONST.S,o[CONST.PARAMETER1]=0,o[CONST.PARAMETER2]=0,sendControlCommand(o)},Wo:function(){var o={};o[CONST.lo]=CONST.R,o[CONST.PARAMETER1]=0,o[CONST.PARAMETER2]=1,sendControlCommand(o)},yo:function(){var o={};o[CONST.lo]=CONST.R,o[CONST.PARAMETER1]=0,o[CONST.PARAMETER2]=0,sendControlCommand(o)},ko:function(){var o={};o[CONST.lo]=CONST.N,o[CONST.PARAMETER1]=0,sendControlCommand(o)},talkToMotor:function(o){var n={};n[CONST.lo]=CONST.m,n[CONST.PARAMETER1]=Number(o),sendControlCommand(n)},setPower:function(o){var n={};n[CONST.lo]=CONST.I,n[CONST.PARAMETER1]=0,n[CONST.PARAMETER2]=Number(o)>>8,n[CONST.PARAMETER3]=255&Number(o),sendControlCommand(n)},setServoDuty:function(o){var n={};n[CONST.lo]=CONST.A,n[CONST.PARAMETER1]=0,n[CONST.PARAMETER2]=Number(o)>>8,n[CONST.PARAMETER3]=255&Number(o),sendControlCommand(n)},Yo:function(){this.toggleMotor(0)},Xo:function(){this.toggleMotor(1)},Ko:function(){this.toggleMotor(2)},Zo:function(){this.toggleMotor(3)},toggleMotor:function(o){var n={};n[CONST.lo]=CONST.P,n[CONST.PARAMETER1]=o,sendControlCommand(n)},ledOn:function(){this.ledControl(0,1)},ledOff:function(){this.ledControl(0,0)},ledControl:function(o,n){var t={};t[CONST.lo]=CONST.v,t[CONST.PARAMETER1]=o,t[CONST.PARAMETER2]=n,sendControlCommand(t)},reboot:function(){var o={};o[CONST.lo]=CONST.k,this.sendCommandFirmware(o)},jo:function(o){var n={};if(n[CONST.lo]=CONST.p,!o){var t=new Date;o=[t.getSeconds(),t.getMinutes(),t.getHours(),t.getDay(),t.getDate(),t.getMonth()+1,t.getFullYear()-2e3]}n=this.appendDic(o,n),sendControlCommand(n)},qo:function(){var o={};o[CONST.lo]=CONST.h,sendControlCommand(o)},showShortText:function(o){var n={};o=o.toString(),n[CONST.lo]=CONST.L,n=stringToByes(o,n,null),sendControlCommand(n)},showLongText:function(o){var n={};n[CONST.lo]=CONST.G,n=stringToByes(o,n,null),sendControlCommand(n)},LCDclearText:function(){var o={};o[CONST.lo]=CONST.B,sendControlCommand(o)},voiceModuleControl:function(o,n){o=(o=o||"").toLowerCase().trim();var t={};n=n||-1;var e={play:CONST.F,nexttrack:CONST.H,prevtrack:CONST.U,gototrack:CONST.V,erasetracks:CONST.W};o in e&&(t[CONST.lo]=e[o],"gototrack"==o&&(t[CONST.PARAMETER1]=n),sendControlCommand(t))}};ext._deviceConnected=function(o){device||((device=o).open(),poller=setInterval(function(){device.read(function(o){var n=new Uint8Array(o);0==n[0]&&(input=n)})},10),setInterval(function(){console.log(input)},3e6))},ext._deviceRemoved=function(o){device==o&&(device=null,resetData(),stopPolling())},ext._shutdown=function(){poller&&clearInterval(poller),poller=null,device&&device.close(),device=null,resetData()},ext._getStatus=function(){return device?{status:2,msg:"Controller connected"}:{status:1,msg:"Controller disconnected"}},ext.readSensor=function(o){return shouldHandle("readSensor"+o)&&gga("send","event","read","sensor",o),getSensorValue(o)},ext.testSensor=function(port,operator,value){if(shouldHandle("testSensor"+port)&&gga("send","event","read","test_sensor",port),shouldHandle("testSensor"+operator)&&gga("send","event","read","test_sensor_operator",operator),descriptor.menus.operator.indexOf(operator)>-1){operator="="==operator?"==":operator;var sensorValue=getSensorValue(port);return eval(sensorValue+operator+value)}return!1},ext.testSwitchPressed=function(o){return shouldHandle("testSwitchPressed"+o)&&gga("send","event","read","test_switch_pressed",o),getSensorValue(o)>500},ext.testSwitchReleased=function(o){return shouldHandle("testSwitchReleased"+o)&&gga("send","event","read","test_switch_release",o),getSensorValue(o)<500},ext.talkToMotor=function(o,n,t,e){var r=convertMotorToBits(o,n,t,e);controls.talkToMotor(r),shouldHandle("talkToMotor"+r)&&gga("send","event","control","motor",r)},ext.turnMotor=function(o){"on"==o?controls.mOn():controls.mOff(),shouldHandle("turnMotor"+o)&&gga("send","event","control","turn_motor",o)},ext.turnMotorOnFor=function(o,n){0==(o=Number(o)||0)||o<0?n():(controls.mOn(),window.setTimeout(function(){controls.mOff(),n()},1e3*o)),shouldHandle("turnMotorOnFor")&&gga("send","event","control","turn_motor_on_for",null,o)},ext.turnMotorDirection=function(o){"Clockwise"==o?controls.Wo():"Counter-Clockwise"==o?controls.yo():controls.ko(),shouldHandle("turnMotorDirection"+o)&&gga("send","event","control","turn_motor_direction",o)},ext.setMotorPower=function(o){o=validateInt(o,0,100),controls.setPower(o),shouldHandle("setMotorPower")&&gga("send","event","control","set_motor_power")},ext.motorIsOn=function(o,n,t,e){shouldHandle("motorIsOn")&&gga("send","event","read","motor_ison");var r=input[23],s=convertMotorToBits(o,n,t,e);if(0==s)return!1;for(var C=0;C<4;C++)if(bitTest(s,C)&&!bitTest(r,C))return!1;return!0},ext.setServoHeading=function(o){o=validateInt(o,0,40),controls.setServoDuty(o),shouldHandle("setServoHeading")&&gga("send","event","control","set_servo_head")},ext.beep=function(){controls.beep(),shouldHandle("beep")&&gga("send","event","control","beep")},ext.zo=function(o){"on"==o?controls.ledOn():controls.ledOff(),shouldHandle("turnLED"+o)&&gga("send","event","control","turn_led",o)};var descriptor={blocks:[["r","sensor %m.sensorList","readSensor",1],["h","when sensor %m.sensorList is %m.operator %n ","testSensor",1,">",500],["h","when switch on sensor %m.sensorList pressed","testSwitchPressed",1],["b","switch on sensor %m.sensorList pressed?","testSwitchPressed",1],["h","when switch on sensor %m.sensorList released","testSwitchReleased",1],[" ","talk to motor %m.motorA %m.motorB %m.motorC %m.motorD","talkToMotor","A"],[" ","turn motor %m.statusMotor","turnMotor","on"],["w","turn motor on for %n secs","turnMotorOnFor",1],[" ","set motor direction to %m.statusDirection","turnMotorDirection","Clockwise"],[" ","set motor power to %n","setMotorPower",100],["b","motor %m.motorA %m.motorB %m.motorC %m.motorD is(are) on?","motorIsOn"],[" ","set servo heading %n","setServoHeading",10],[" ","beep","beep"],[" ","turn on-board LED %m.statusMotor","turnLED","on"]],menus:{sensorList:[1,2,3,4,5,6,7,8],operator:["=",">",">=","<","<="],motorList:["A","B","C","D"],motorA:[" ","A"],motorB:[" ","B"],motorC:[" ","C"],motorD:[" ","D"],statusMotor:["on","off"],statusDirection:["Clockwise","Counter-Clockwise","Reserverse"]}};ScratchExtensions.register("GoGo Board Extension",descriptor,ext,{type:"hid",vendor:1121,product:32})};