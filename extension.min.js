new function(){var CONST={o:0,t:1,s:2,C:3,_:0,T:1,O:2,i:1,S:2,u:3,N:4,R:6,I:7,m:8,v:9,P:10,A:11,g:12,M:13,D:50,p:51,h:60,L:61,G:62,B:70,H:71,V:72,F:73,U:74,W:100,k:14,Y:17,X:18,K:1,Z:2,j:3,J:4,$:1,oo:2,no:10,to:11,eo:12,ro:15,so:16,Co:17,_o:18,ao:19,To:20,lo:25,Oo:26,io:0,So:1,do:2,PARAMETER1:3,PARAMETER2:4,PARAMETER3:5,PARAMETER4:6,PARAMETER5:7,PARAMETER6:8,PARAMETER7:9,uo:64,co:64,No:5,countNoData:0,Ro:17,Eo:18,Io:20,mo:25,vo:33,Po:0,Ao:1,fo:2,Mo:3,Do:4,RPI_REG_IP_1:10,RPI_REG_IP_2:11,RPI_REG_IP_3:12,RPI_REG_IP_4:13,RPI_REG_WLAN_IP_1:14,RPI_REG_WLAN_IP_2:15,RPI_REG_WLAN_IP_3:16,RPI_REG_WLAN_IP_4:17,po:18,ho:19,Lo:20,Go:21,wo:22,Bo:23,bo:24,xo:25,Ho:26,Vo:27,Fo:28,Uo:29,Wo:0,ko:1,yo:2},MOTOR_DICT={a:1,b:2,c:3,d:4},device=null,input=new Uint8Array(CONST.co),poller=null,ext=this,handledCmds={},a,b,c,e,f,g;function resetData(){input=new Uint8Array(CONST.co)}function sendToBoard(o){device.write(o)}a=window,b=document,c="script",e="gga",a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src="https://www.google-analytics.com/analytics.js",g.parentNode.insertBefore(f,g),gga("create","UA-83816046-7","auto"),gga("send","pageview");var sendCommand=function(o){if(device){var n=new ArrayBuffer(CONST.uo),t=new Uint8Array(n);for(var e in o)t[parseInt(e)-0]=o[e];device.write(n)}},sendControlCommand=function(o){o[CONST.So]=CONST._,sendCommand(o)},stringToByes=function(o,n,t){o=o.toString(),t=t||CONST.PARAMETER1,60<o.length&&(o=o.substring(0,60));var e=0;if(!n)return e;for(var r in o)n[t+e]=o.charCodeAt(e),e+=1;return n[t+e]=0,n},controls={ping:function(){var o={};o[CONST.do]=CONST.i,o[CONST.PARAMETER1]=0,sendControlCommand(o)},pingNode:function(o){var n={};n[CONST.do]=CONST.i,n[CONST.PARAMETER1]=1,n[CONST.PARAMETER2]=o,sendControlCommand(n)},beep:function(){var o=[];o[CONST.do]=CONST.A,sendControlCommand(o)},setAutorun:function(o){var n={};n[CONST.do]=CONST.g,n[CONST.PARAMETER1]=o,sendControlCommand(n)},LogoControl:function(o){o=parseInt(o);var n={};n[CONST.do]=CONST.M,n[CONST.PARAMETER1]=o,sendControlCommand(n)},mOn:function(){var o={};o[CONST.do]=CONST.S,o[CONST.PARAMETER1]=0,o[CONST.PARAMETER2]=1,sendControlCommand(o)},mOff:function(){var o={};o[CONST.do]=CONST.S,o[CONST.PARAMETER1]=0,o[CONST.PARAMETER2]=0,sendControlCommand(o)},Yo:function(){var o={};o[CONST.do]=CONST.u,o[CONST.PARAMETER1]=0,o[CONST.PARAMETER2]=1,sendControlCommand(o)},Xo:function(){var o={};o[CONST.do]=CONST.u,o[CONST.PARAMETER1]=0,o[CONST.PARAMETER2]=0,sendControlCommand(o)},Ko:function(){var o={};o[CONST.do]=CONST.N,o[CONST.PARAMETER1]=0,sendControlCommand(o)},talkToMotor:function(o){var n={};n[CONST.do]=CONST.I,n[CONST.PARAMETER1]=Number(o),sendControlCommand(n)},setPower:function(o){var n={};n[CONST.do]=CONST.R,n[CONST.PARAMETER1]=0,n[CONST.PARAMETER2]=Number(o)>>8,n[CONST.PARAMETER3]=255&Number(o),sendControlCommand(n)},setServoDuty:function(o){var n={};n[CONST.do]=CONST.v,n[CONST.PARAMETER1]=0,n[CONST.PARAMETER2]=Number(o)>>8,n[CONST.PARAMETER3]=255&Number(o),sendControlCommand(n)},setGogo6ServoAngle:function(o,n){var t={},e=0;o<0||4<o||(0<o&&(e=1<<o-1),t[CONST.do]=CONST.Y,t[CONST.PARAMETER1]=e,t[CONST.PARAMETER2]=Number(n)>>8,t[CONST.PARAMETER3]=255&Number(n),sendControlCommand(t))},Zo:function(){this.toggleMotor(0)},jo:function(){this.toggleMotor(1)},qo:function(){this.toggleMotor(2)},zo:function(){this.toggleMotor(3)},toggleMotor:function(o){var n={};n[CONST.do]=CONST.m,n[CONST.PARAMETER1]=o,sendControlCommand(n)},talkToServo:function(o){var n={};n[CONST.do]=CONST.k,n[CONST.PARAMETER1]=Number(o),sendControlCommand(n)},ledOn:function(){this.ledControl(0,1)},ledOff:function(){this.ledControl(0,0)},ledControl:function(o,n){var t={};t[CONST.do]=CONST.P,t[CONST.PARAMETER1]=o,t[CONST.PARAMETER2]=n,sendControlCommand(t)},reboot:function(){var o={};o[CONST.do]=CONST.W,this.sendCommandFirmware(o)},Jo:function(o){var n={};if(n[CONST.do]=CONST.D,!o){var t=new Date;o=[t.getSeconds(),t.getMinutes(),t.getHours(),t.getDay(),t.getDate(),t.getMonth()+1,t.getFullYear()-2e3]}n=this.appendDic(o,n),sendControlCommand(n)},Qo:function(){var o={};o[CONST.do]=CONST.p,sendControlCommand(o)},showShortText:function(o){var n={};o=o.toString(),n[CONST.do]=CONST.h,n=stringToByes(o,n,null),sendControlCommand(n)},showLongText:function(o){var n={};n[CONST.do]=CONST.L,n=stringToByes(o,n,null),sendControlCommand(n)},LCDclearText:function(){var o={};o[CONST.do]=CONST.G,sendControlCommand(o)},voiceModuleControl:function(o,n){o=(o=o||"").toLowerCase().trim();var t={};n=n||-1;var e={play:CONST.B,nexttrack:CONST.H,prevtrack:CONST.V,gototrack:CONST.F,erasetracks:CONST.U};o in e&&(t[CONST.do]=e[o],"gototrack"==o&&(t[CONST.PARAMETER1]=n),sendControlCommand(t))}};function stopPolling(){poller&&clearInterval(poller),poller=null}function convertByteStr(o){return(parseInt(o,16)-128)/128}function bytesToInt(o,n){return(o<<8)+n}function bitSet(o,n){return o|1<<n}function bitTest(o,n){return(o>>n)%2!=0}function validateInt(o,n,t){return n=n||0,o=(o=parseInt(o)||0)<0?0:o,t&&(o=t<o?t:o),o}function getMotorID(o){return(o=o||"").toLowerCase()in MOTOR_DICT?MOTOR_DICT[o.toLowerCase()]:0}function convertMotorToBits(o,n,t,e){for(var r=0,s=[o,n,t,e],C=0;C<s.length;C++){getMotorID(s[C])==C+1&&(r=bitSet(r,C))}return r}function convertServoMotorToBits(o,n,t,e){for(var r=0,s=[o,n,t,e],C=0;C<s.length;C++){parseInt(s[C])==C+1&&(r=bitSet(r,C))}return r}function getSensorValue(o){var n=0;return!(o=parseInt(o))||o<1||8<o||1020<=(n=bytesToInt(input[2*o-1],input[2*o-1+1]))&&(n=1024),n}function shouldHandle(o){var n=null==handledCmds[o];return n&&(handledCmds[o]=!0),n}ext._deviceConnected=function(o){device||((device=o).open(),poller=setInterval(function(){device.read(function(o){var n=new Uint8Array(o);0==n[0]&&(input=n)})},10),setInterval(function(){console.log(input)},3e6))},ext._deviceRemoved=function(o){device==o&&(device=null,resetData(),stopPolling())},ext._shutdown=function(){poller&&clearInterval(poller),poller=null,device&&device.close(),device=null,resetData()},ext._getStatus=function(){return device?{status:2,msg:"Controller connected"}:{status:1,msg:"Controller disconnected"}},ext.readSensor=function(o){return shouldHandle("readSensor"+o)&&gga("send","event","read","sensor",o),getSensorValue(o)},ext.testSensor=function(port,operator,value){if(shouldHandle("testSensor"+port)&&gga("send","event","read","test_sensor",port),shouldHandle("testSensor"+operator)&&gga("send","event","read","test_sensor_operator",operator),-1<descriptor.menus.operator.indexOf(operator)){operator="="==operator?"==":operator;var sensorValue=getSensorValue(port);return eval(sensorValue+operator+value)}return!1},ext.testSwitchPressed=function(o){return shouldHandle("testSwitchPressed"+o)&&gga("send","event","read","test_switch_pressed",o),500<getSensorValue(o)},ext.testSwitchReleased=function(o){return shouldHandle("testSwitchReleased"+o)&&gga("send","event","read","test_switch_release",o),getSensorValue(o)<500},ext.talkToMotor=function(o,n,t,e){var r=convertMotorToBits(o,n,t,e);controls.talkToMotor(r),shouldHandle("talkToMotor"+r)&&gga("send","event","control","motor",r)},ext.turnMotor=function(o){"on"==o?controls.mOn():controls.mOff(),shouldHandle("turnMotor"+o)&&gga("send","event","control","turn_motor",o)},ext.turnMotorOnFor=function(o,n){0==(o=Number(o)||0)||o<0?n():(controls.mOn(),window.setTimeout(function(){controls.mOff(),n()},1e3*o)),shouldHandle("turnMotorOnFor")&&gga("send","event","control","turn_motor_on_for",null,o)},ext.turnMotorDirection=function(o){"Clockwise"==o?controls.Yo():"Counter-Clockwise"==o?controls.Xo():controls.Ko(),shouldHandle("turnMotorDirection"+o)&&gga("send","event","control","turn_motor_direction",o)},ext.setMotorPower=function(o){o=validateInt(o,0,100),controls.setPower(o),shouldHandle("setMotorPower")&&gga("send","event","control","set_motor_power")},ext.motorIsOn=function(o,n,t,e){shouldHandle("motorIsOn")&&gga("send","event","read","motor_ison");var r=input[23],s=convertMotorToBits(o,n,t,e);if(0==s)return!1;for(var C=0;C<4;C++)if(bitTest(s,C)&&!bitTest(r,C))return!1;return!0},ext.talkToServo=function(o,n,t,e){var r=convertServoMotorToBits(o,n,t,e);controls.talkToServo(r),shouldHandle("talkToServo"+r)&&gga("send","event","control","motor",r)},ext.setServoHeading=function(o){o=validateInt(o,0,40),controls.setServoDuty(o),shouldHandle("setServoHeading")&&gga("send","event","control","set_servo_head")},ext.setGogo6ServoAngle=function(o,n){o=validateInt(o,1,4),n=validateInt(n,0,180),controls.setGogo6ServoAngle(o,n),shouldHandle("setGogo6ServoAngle")&&gga("send","event","control","set_gogo6_servo_angle")},ext.setGogo6CurrentServoAngle=function(o){o=validateInt(o,0,180),controls.setGogo6ServoAngle(0,o),shouldHandle("setGogo6ServoAngle")&&gga("send","event","control","set_gogo6_servo_angle")},ext.beep=function(){controls.beep(),shouldHandle("beep")&&gga("send","event","control","beep")},ext.$o=function(o){"on"==o?controls.ledOn():controls.ledOff(),shouldHandle("turnLED"+o)&&gga("send","event","control","turn_led",o)};var descriptor={blocks:[["r","sensor %m.sensorList","readSensor",1],["h","when sensor %m.sensorList is %m.operator %n ","testSensor",1,">",500],["h","when switch on sensor %m.sensorList pressed","testSwitchPressed",1],["b","switch on sensor %m.sensorList pressed?","testSwitchPressed",1],["h","when switch on sensor %m.sensorList released","testSwitchReleased",1],[" ","talk to motor %m.motorA %m.motorB %m.motorC %m.motorD","talkToMotor","A"],[" ","turn motor %m.statusMotor","turnMotor","on"],["w","turn motor on for %n secs","turnMotorOnFor",1],[" ","set motor direction to %m.statusDirection","turnMotorDirection","Clockwise"],[" ","set motor power to %n","setMotorPower",100],["b","motor %m.motorA %m.motorB %m.motorC %m.motorD is(are) on?","motorIsOn"],[" ","set servo heading %n","setServoHeading",10],[" ","set servo angle on port %m.servoList to %n","setGogo6ServoAngle","1",100],[" ","beep","beep"],[" ","turn on-board LED %m.statusMotor","turnLED","on"]],menus:{sensorList:[1,2,3,4,5,6,7,8],operator:["=",">",">=","<","<="],motorList:["A","B","C","D"],servoList:["1","2","3","4"],motorA:[" ","A"],motorB:[" ","B"],motorC:[" ","C"],motorD:[" ","D"],Servo1:[" ","1"],Servo2:[" ","2"],Servo3:[" ","3"],Servo4:[" ","4"],statusMotor:["on","off"],statusDirection:["Clockwise","Counter-Clockwise","Reserverse"]}};ScratchExtensions.register("GoGo Board Extension",descriptor,ext,{type:"hid",vendor:1121,product:32})};